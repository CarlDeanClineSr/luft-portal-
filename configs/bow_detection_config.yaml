# Bow Pattern Detection Configuration
# =====================================
# Configuration for detecting loading-relaxation-reload cycles in χ amplitude data
# Discovered by Carl Dean Cline Sr., 2025-12-31
# Lincoln, Nebraska, USA

detection_parameters:
  # Loading phase: χ rises significantly over 1-4 hours
  loading_min_rise: 0.02          # Minimum rise in χ value
  loading_min_duration: 1.0       # Minimum duration in hours
  loading_max_duration: 4.0       # Maximum duration in hours
  
  # Peak: Local maximum near the χ = 0.15 boundary
  # Physical significance: 0.125 represents ~83% of boundary (0.125/0.15), ensuring
  # we only detect significant magnetosphere energy states, not minor fluctuations.
  # The 0.03 distance threshold (20% of boundary) captures peaks approaching the
  # universal limit while excluding far-field variations.
  peak_min_chi: 0.125             # Minimum χ value at peak (83% of boundary)
  peak_max_distance_from_boundary: 0.03  # Within 0.03 of the 0.15 boundary (20%)
  
  # Relaxation: χ drops after peak (energy release)
  relaxation_min_drop: 0.015      # Minimum drop in χ value
  relaxation_min_duration: 1.0    # Minimum duration in hours
  relaxation_max_duration: 3.0    # Maximum duration in hours
  
  # Reload: χ rises again after relaxation
  reload_min_rise: 0.01           # Minimum rise in χ value
  reload_min_duration: 2.0        # Minimum duration in hours
  reload_max_duration: 5.0        # Maximum duration in hours
  
  # Peak detection parameters (for scipy.signal.find_peaks)
  peak_prominence: 0.015          # Minimum prominence for peak detection
  peak_distance: 60               # Minimum distance between peaks (minutes)

classification:
  # Single bow: One complete loading-relaxation-reload cycle
  single_bow:
    requires:
      - loading_phase
      - peak
      - relaxation
      - reload
    description: "Complete loading-relaxation-reload cycle"
  
  # Double bow: Two consecutive bow patterns
  double_bow:
    requires:
      - first_bow_complete
      - second_bow_within_time: 6.0  # hours
    description: "Two consecutive bow patterns within 6 hours"
  
  # Failed bow: Loading to peak but no significant reload
  failed_bow:
    requires:
      - loading_phase
      - peak
      - relaxation
      - no_reload
    description: "Loading and relaxation without significant reload"

output:
  # Report directory
  report_path: "reports/bow_patterns/"
  
  # Data export formats
  save_csv: true
  save_json: true
  
  # Visualization options
  create_plots: true
  plot_dpi: 150
  plot_format: "png"
  
  # Visualization settings
  visualizations:
    # Distribution plots
    - type: "histogram"
      title: "Bow Pattern Loading Times"
      filename: "loading_times_dist.png"
      bins: 20
    
    - type: "histogram"
      title: "Bow Pattern Peak χ Values"
      filename: "peak_chi_dist.png"
      bins: 25
    
    - type: "histogram"
      title: "Bow Pattern Relaxation Times"
      filename: "relaxation_times_dist.png"
      bins: 20
    
    # Temporal analysis
    - type: "hourly_distribution"
      title: "Bow Pattern Occurrence by Hour of Day"
      filename: "hourly_distribution.png"
    
    # Timeseries overlay
    - type: "timeseries"
      title: "Detected Bow Patterns Timeline"
      filename: "bow_patterns_timeline.png"
      show_top_n: 20

correlation:
  # Solar wind parameters to correlate with
  parameters:
    - speed
    - bz
    - density
    - bt
  
  # Correlation time windows
  time_windows:
    - -6   # 6 hours before peak
    - 0    # At peak
    - 6    # 6 hours after peak
    - 12   # 12 hours after peak
  
  # Minimum correlation coefficient to report
  min_correlation: 0.3

# Data sources
data_sources:
  # Raw magnetic field data (Bx, By, Bz components)
  # The detector will calculate χ internally using Carl's 24-hour centered rolling baseline
  chi_data:
    - "data/noaa_solarwind/noaa_mag_*.csv"
    - "data/dscovr_mag_*.csv"
    - "data/dscovr_*.json"
    - "data/ace_mag_*.csv"
    - "data/magnetometer_*.csv"
    # NOTE: Explicitly excluding old chi_analysis files that use incorrect baseline method
    # - "data/chi_analysis_*.csv"  # DO NOT USE - wrong baseline calculation
    # - "data/ace_plasma_audit_normalized_with_chi.json"  # DO NOT USE - wrong baseline
    # - "data/chi_boundary_tracking.jsonl"  # DO NOT USE - wrong baseline
  
  # Column name mappings for different data sources
  # The detector automatically detects these variations
  column_mappings:
    dscovr:
      timestamp: "time_tag"
      bx: "bx_gsm"
      by: "by_gsm"
      bz: "bz_gsm"
    ace:
      timestamp: "timestamp"
      bx: "Bx"
      by: "By"
      bz: "Bz"
    maven:
      timestamp: "TT2000"
      bx: "BX-OUTB"
      by: "BY-OUTB"
      bz: "BZ-OUTB"
    generic:
      timestamp: "timestamp"
      bx: "bx"
      by: "by"
      bz: "bz"
  
  # Solar wind parameters
  solar_wind:
    - "data/noaa_solarwind/*.csv"
    - "data/ace_plasma_audit_normalized.json"

# Physical interpretation
physical_context:
  boundary: 0.15
  energy_unit: "normalized_magnetic_perturbation"
  interpretation: "Magnetosphere loading-relaxation-reload cycles"
  discovery_date: "2025-12-31"
  discoverer: "Carl Dean Cline Sr."
  location: "Lincoln, Nebraska, USA"
