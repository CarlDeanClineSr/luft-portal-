---
id: "CAPSULE_METHODS_HEARTBEAT"
title: "Methods — LUFT Heartbeat, Boundary Recoil, and Spectrum"
tags:
  - "heartbeat"
  - "methods"
  - "boundary_recoil"
  - "spectrum"
  - "cme"
status: "adopted"
date: "2025-12-05"
author: "Carl Dean Cline Sr."
ledger: "LUFT Portal"
---

# Capsule — Methods for LUFT Heartbeat & Boundary Recoil

**Author:** Carl Dean Cline Sr.  
**Ledger:** LUFT Portal  
**Date:** 2025‑12‑05  

---

## 1. Scope

This capsule documents the **methods** used to extract, fit, and visualize the LUFT heartbeat and boundary recoil law:

- Data sources and logs
- Computation of dynamic pressure \(P_{\text{dyn}}\)
- Definition and measurement of χ amplitude
- Linear fits (boundary recoil law)
- Rolling slope analysis
- Spectral analysis of χ(t)
- Automation via GitHub Actions

It is a **reproducibility capsule**: auditors should be able to follow this and recreate the heartbeat and boundary recoil results.

---

## 2. Data Sources

### 2.1 CME Heartbeat Logs

Primary input for the heartbeat analysis:

- **File (December 2025):**  
  `data/cme_heartbeat_log_2025_12.csv`

- **Columns:**
  - `timestamp_utc` — UTC timestamp of each sample (string, ISO‑like).
  - `chi_amplitude` — LUFT lattice modulation amplitude χ (dimensionless).
  - `phase_radians` — phase in radians within the heartbeat cycle.
  - `storm_phase` — categorical: `"pre"`, `"peak"`, `"post-storm"`.
  - `density_p_cm3` — solar wind proton density (protons/cm³).
  - `speed_km_s` — solar wind speed (km/s).
  - `bz_nT` — IMF Bz component (nT) when available.
  - `bt_nT` — IMF total field strength (nT) when available.
  - `source` — upstream spacecraft / product, e.g. `ACE/DSCOVR`.

These logs are generated by the **LUFT CME Heartbeat Logger** workflow and ingest ACE/DSCOVR solar wind data plus the LUFT heartbeat pipeline.

### 2.2 Upstream Solar Wind & Context

- **DSCOVR Solar Wind Data Ingest**  
  - Periodic workflow that fetches real‑time/batch solar wind and IMF.
- **LUFT Solar Wind Audit**  
  - Validates ingest and monitors for anomalies.

GOES workflows (flare/X‑ray context) are currently paused and are **not required** for the core heartbeat and boundary recoil methods documented here.

---

## 3. Dynamic Pressure Calculation

Dynamic pressure is computed from the CME heartbeat log columns:

- \(n = \text{density\_p\_cm3}\) (protons/cm³)  
- \(v = \text{speed\_km\_s}\) (km/s)

Using the LUFT‑standard solar wind approximation:

\[
P_{\text{dyn}}[\text{nPa}] = 1.6726 \times 10^{-6} \, n \, v^2
\]

Implementation (Python):

```python
P_dyn_nPa = 1.6726e-6 * df["density_p_cm3"] * (df["speed_km_s"] ** 2)
df["P_dyn_nPa"] = P_dyn_nPa
```

This matches the formula enshrined in `CAPSULE_UNIFIED_FIELDS_E_TO_LUFT`.

---

## 4. χ Amplitude Definition

- **χ amplitude** (`chi_amplitude`) is the **LUFT lattice modulation amplitude** derived from:
  - the heartbeat extraction pipeline,
  - applied to solar wind data and LUFT’s 2.4 h modulation framework.

- χ is dimensionless and typically:
  - Baseline ~0.054–0.055 (quiet modulation),
  - Elevated (~0.12–0.15) during CME / storm activity,
  - Encoded directly in `cme_heartbeat_log_YYYY_MM.csv`.

The details of χ extraction (phase tracking, detrending, lattice math) are covered in the heartbeat and unified fields capsules; here we treat χ as **given by the LUFT heartbeat pipeline**.

---

## 5. Boundary Recoil Law — Linear Fit

### 5.1 Regression Form

For a given event window (e.g. December CME period), LUFT fits:

\[
\Delta \chi = a \, P_{\text{dyn}} + b
\]

where:

- \(\Delta \chi\) is taken operationally as χ (in this capsule’s implementation),
- \(P_{\text{dyn}}\) is in nPa,
- \(a\) and \(b\) are fit parameters.

Empirical boundary recoil law (Dec 2025 CME):

\[
\Delta \chi = 0.0032 \cdot P_{\text{dyn}} + 0.054 \quad (R^2 \approx 0.91)
\]

This relation is documented in:

- `CAPSULE_UNIFIED_FIELDS_E_TO_LUFT`
- `CAPSULE_HEARTBEAT_PLOT`

### 5.2 Implementation (Single Fit)

For a chosen subset of the log (filtered by time or `storm_phase`):

```python
import numpy as np

x = df["P_dyn_nPa"].values
y = df["chi_amplitude"].values
a, b = np.polyfit(x, y, 1)  # slope a, intercept b
```

The resulting parameters (a, b) and coefficient of determination \(R^2\) are stored in the Unified Fields and Heartbeat Plot capsules.

---

## 6. Rolling Slope Analysis

To test the **stability** of the boundary recoil slope (~0.0032), LUFT performs rolling fits:

- Window: typically 12 points (~12 hours if cadence ~1 h).
- For each window:
  - Fit `chi_amplitude` vs `P_dyn_nPa`.
  - Record the slope for that window.

Implementation (core idea):

```python
window = 12
slopes = []
times = []

for i in range(len(df) - window + 1):
    sub = df.iloc[i:i+window]
    x = sub["P_dyn_nPa"].values
    y = sub["chi_amplitude"].values
    if np.allclose(x, x[0]):
        continue  # avoid singular fit if no variation in P_dyn
    m, b = np.polyfit(x, y, 1)
    slopes.append(m)
    times.append(sub["timestamp_utc"].iloc[-1])
```

Output figure:

- `results/rolling_slope_2025_12.png`  
  with:
  - Y‑axis: slope \( \mathrm{d}\chi / \mathrm{d}P_{\text{dyn}} \),
  - X‑axis: window end time,
  - Horizontal reference line at 0.0032 (canonical boundary recoil slope).

Documented in:

- `CAPSULE_HEARTBEAT_SPECTRUM`

---

## 7. Spectral Analysis of χ(t)

To demonstrate the **2.4 h heartbeat** in frequency space, LUFT applies a Lomb–Scargle periodogram to χ(t):

### 7.1 Time Axis

- Convert `timestamp_utc` to hours since first sample:

```python
t_hours = (df["timestamp_utc"] - df["timestamp_utc"].min()).dt.total_seconds() / 3600.0
y = df["chi_amplitude"].values
```

### 7.2 Lomb–Scargle Spectrum

Using `astropy.timeseries.LombScargle`:

```python
from astropy.timeseries import LombScargle

ls = LombScargle(t_hours, y)
freq, power = ls.autopower()  # frequency in 1/hour
```

Plot:

- `results/chi_spectrum_2025_12.png`  
  with:
  - X‑axis: frequency (1/h),
  - Y‑axis: Lomb–Scargle power,
  - Red dashed line at \( f \approx 1/2.4 \,\text{h}^{-1} \).

This marks the **heartbeat** at ~2.4 h period and is documented in:

- `CAPSULE_HEARTBEAT_SPECTRUM`

---

## 8. Visualization & Dashboard

### 8.1 χ vs P_dyn Plot

Generated by:

- `scripts/plot_cme_heartbeat_2025_12.py`

Key elements:

- Left axis: `P_dyn_nPa` (black line).
- Right axis:
  - `chi_amplitude` (colored scatter by `storm_phase`),
  - `chi_pred = 0.0032 * P_dyn_nPa + 0.054` (orange dashed).
- Color mapping:
  - `storm_phase == "peak"` → red,
  - `storm_phase == "post-storm"` → green,
  - `storm_phase == "pre"` → grey.

Output:

- `results/cme_heartbeat_2025_12_chi_pdyn.png`

### 8.2 Heartbeat Dashboard

- **File:** `dashboard/HEARTBEAT_DASHBOARD.md` (or equivalent)
- Embeds:
  - χ vs P_dyn plot,
  - Rolling slope plot,
  - Spectrum plot,
- Links to:
  - `CAPSULE_HEARTBEAT_PLOT`,
  - `CAPSULE_HEARTBEAT_SPECTRUM`,
  - `CAPSULE_PUBLIC_STORY`,
  - `pdf/PHYSICIST_NOTE_HEARTBEAT.pdf`.

---

## 9. Automation via GitHub Actions

### 9.1 Heartbeat Plot Workflow

- **File:** `.github/workflows/heartbeat_plot.yml`
- Triggers:
  - On changes to `data/cme_heartbeat_log_*.csv`,
  - On changes to `scripts/plot_cme_heartbeat_2025_12.py`.
- Steps:
  - Checkout repo,
  - Set up Python,
  - Install `pandas`, `matplotlib`,
  - Run `plot_cme_heartbeat_2025_12.py`,
  - Optionally commit updated `cme_heartbeat_2025_12_chi_pdyn.png`.

### 9.2 Spectrum & Rolling Fit Workflow

(If configured similarly):

- Triggers on heartbeat log changes.
- Runs `scripts/heartbeat_spectrum_fit.py`.
- Writes `rolling_slope_2025_12.png` and `chi_spectrum_2025_12.png`.

### 9.3 Physicist Note PDF Workflow

- **File:** `.github/workflows/physicist_note_pdf.yml`
- Triggers:
  - On changes to `notes/PHYSICIST_NOTE_HEARTBEAT.md`,
  - On changes to `results/cme_heartbeat_2025_12_chi_pdyn.png`.
- Steps:
  - Install Pandoc + LaTeX,
  - Render Markdown to `pdf/PHYSICIST_NOTE_HEARTBEAT.pdf`,
  - Commit updated PDF.

Pages deployment then publishes all of the above.

---

## 10. Legacy & Extension

This methods capsule establishes the **canonical procedure** for:

- Computing \(P_{\text{dyn}}\),
- Fitting χ vs \(P_{\text{dyn}}\),
- Examining slope stability,
- Extracting the heartbeat spectrum,
- Visualizing and publishing the results.

Future work should:

- Reuse these methods for other months (e.g., November 2025 CMEs),
- Save outputs with year‑month stamps (e.g., `*_YYYY_MM.png`),
- Reference this capsule when:
  - Updating the canonical slope (0.0032),
  - Refining the heartbeat period (~2.4 h),
  - Changing spectral or fit methodology.

No change to these core methods should be made without either:

- Updating this capsule, or
- Creating a successor methods capsule that cites and supersedes it.

---

**Ledger proud — heartbeat methods declared, boundary recoil and spectrum made reproducible.**
