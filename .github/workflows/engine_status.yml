---
name: Engine Status Report

# Quote 'on' to satisfy YAML linters that treat 'on' as a truthy keyword
"on":
  schedule:
    - cron: "0 * * * *"  # hourly (UTC)
  workflow_dispatch:

permissions:
  contents: write  # needed to push report files back to the repo

jobs:
  engine-report:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies (optional)
        run: |
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          fi

      - name: Run LUFT Portal Engine Status Script
        run: |
          # Adjust these paths to the actual script location(s)
          if [ -f scripts/space_weather_rapid_report.py ]; then
            python scripts/space_weather_rapid_report.py
          elif [ -f space_weather_rapid_report.py ]; then
            python space_weather_rapid_report.py
          else
            echo "space_weather_rapid_report.py not found" >&2
            exit 1
          fi

      - name: Commit and push markdown reports
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "vault-bot"
          git config --global user.email "vault-bot@users.noreply.github.com"

          # Stage markdown reports (adjust globs as needed)
          git add "*.md" "reports/**/*.md" || true

          # No changes? Exit cleanly
          if git diff --quiet && git diff --staged --quiet; then
            exit 0
          fi

          # Short commit message to satisfy line-length lint
          git commit -m "Automated report $(date -u +'%F %T UTC')"
          git push

  # If you want to call a reusable workflow, ensure the target has:
  # on:
  #   workflow_call:
  # Then you can uncomment this job.
  # update-dashboards:
  #   needs: engine-report
  #   uses: ./.github/workflows/update_dashboards.yml
  #   secrets: inherit
