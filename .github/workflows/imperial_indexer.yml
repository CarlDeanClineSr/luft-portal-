name: Imperial Search Indexer

on:
  schedule:
    # Run every 6 hours (00:00, 06:00, 12:00, 18:00 UTC)
    - cron: '0 */6 * * *'
  workflow_dispatch: # Allows you to click the button manually

# GRANT PERMISSIONS TO WRITE TO THE REPO (Critical for stability)
permissions:
  contents: write

jobs:
  ping_search_engines:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install Dependencies
      run: |
        pip install requests

    - name: Fire Indexing Script
      run: |
        python scripts/force_index.py

    # THE "BULLETPROOF" COMMIT SEQUENCE
    # This ensures that if the script saves any logs/data, the bot won't crash.
    - name: Imperial Commit & Sync
      run: |
        # 1. Identity
        git config --local user.email "action@github.com"
        git config --local user.name "Imperial Bot"
        
        # 2. Stage Changes (If any)
        git add .
        
        # 3. Commit (Or skip if empty)
        git commit -m "Imperial Indexing Log [skip ci]" || echo "No changes to record"
        
        # 4. Sync with Server (Rebase to avoid conflicts)
        git pull origin main --rebase
        
        # 5. Push
        git push origin main
