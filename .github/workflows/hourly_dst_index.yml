import requests
import datetime

def fetch_dst_imperial():
    # IMPERIAL ALIGNMENT: Truncate to whole minutes/seconds to prevent 422 error
    now = datetime.datetime.now(datetime.timezone.utc).replace(microsecond=0)
    start_time = (now - datetime.timedelta(days=7)).strftime('%Y-%m-%dT%H:%M:%S')
    end_time = now.strftime('%Y-%m-%dT%H:%M:%S')

    # Corrected USGS Endpoint for Dst Interrogation
    url = "https://geomag.usgs.gov/ws/data/"
    params = {
        "id": "USGS",       # Required: Source ID
        "type": "dst",      # Required: Data type
        "starttime": start_time,
        "endtime": end_time,
        "format": "json"
    }

    print(f"üîç Interrogating Lattice Tension (Dst): {start_time} to {end_time}")
    
    response = requests.get(url, params=params)
    
    if response.status_code == 200:
        # Process the 0.15 chi-relevant tension data here
        print("‚úÖ Handshake successful. Dst tension recorded.")
        # ... (save data logic)
    else:
        print(f"‚ùå Handshake failed: {response.status_code} - {response.text}")
        raise Exception("Lattice Interrogation Error")

if __name__ == "__main__":
    fetch_dst_imperial()
