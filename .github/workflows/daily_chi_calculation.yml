name: Daily χ Calculation (Cross-Domain)

on:
  schedule:
    - cron: '0 6 * * *'  # Daily at 06:00 UTC
  workflow_dispatch:

jobs:
  compute-chi:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      - name:  Install dependencies
        run: pip install pandas numpy
      
      - name: Compute χ from Oulu cosmic rays
        run: python scripts/compute_chi_from_oulu.py
        continue-on-error: true
      
      - name: Compute χ from USGS earthquakes
        run: python scripts/compute_chi_from_usgs.py
        continue-on-error:  true
      
      - name:  Compute χ from INTERMAGNET magnetometer
        run: python scripts/compute_chi_from_intermagnet.py
        continue-on-error: true
      
      - name: Commit χ results
        run: |
          git config user.name "LUFT Bot"
          git config user.email "bot@luft.local"
          git pull --rebase
          git add results/oulu_chi/* results/usgs_chi/* results/intermagnet_chi/* || echo "No χ results"
          git commit -m "results: Daily χ calculation across domains $(date -u)" || echo "No new χ data"
          git push || echo "Push failed"
